<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ë°©íƒˆì¶œ ê²Œì„: 2 STAGE CHALLENGE</title>
    <style>
        /* í†µí•© CSS ì½”ë“œ */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #000;
        }

        .room-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: none; /* JSë¡œ ì œì–´ */
        }

        .background-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .object {
            position: absolute;
            cursor: pointer;
            border-radius: 15px;
            transition: box-shadow 0.3s ease-in-out, transform 0.2s ease, background-color 0.3s ease;
            z-index: 10;
            /* í´ë¦­ ì˜ì—­ í‘œì‹œ (ê°œë°œìš©, ì™„ì„± í›„ ì´ ì¤„ì„ ì§€ìš°ì„¸ìš”.) */
            background-color: rgba(255, 255, 0, 0.2);
        }

        .object:hover {
            box-shadow: 0 0 25px 10px rgba(255, 255, 0, 0.5);
            background-color: rgba(255, 255, 0, 0.35);
            transform: scale(1.05);
        }

        /* --- 1ë‹¨ê³„ ì˜¤ë¸Œì íŠ¸ ìœ„ì¹˜ --- */
        #s1-pencil-case { top: 65%; left: 35%; width: 10%; height: 10%; }
        #s1-bookshelf { top: 28%; left: 1%; width: 22%; height: 45%; }
        #s1-poster { top: 32%; left: 63%; width: 16%; height: 28%; }
        #s1-school-bag { top: 58%; left: 85%; width: 13%; height: 22%; }
        #s1-door { top: 28%; left: 25%; width: 12%; height: 46%; }

        /* --- 2ë‹¨ê³„ ì˜¤ë¸Œì íŠ¸ ìœ„ì¹˜ --- */
        #s2-beads { top: 62%; left: 47%; width: 6%; height: 9%; }
        #s2-bookshelf { top: 26%; left: 73%; width: 18%; height: 42%; }
        #s2-wizard { top: 54%; left: 19%; width: 12%; height: 22%; }
        #s2-potion { top: 74%; left: 79%; width: 7%; height: 13%; }
        #s2-fireplace { top: 68%; left: 5%; width: 14%; height: 18%; }

        /* --- ëª¨ë‹¬ ê³µí†µ ìŠ¤íƒ€ì¼ --- */
        .modal {
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            max-width: 500px;
            text-align: center;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
        }

        #start-screen .modal-content input {
            display: block; width: 80%; margin: 10px auto; padding: 12px;
            font-size: 16px; border-radius: 5px; border: 1px solid #ccc;
        }

        .close-button {
            color: #aaa; position: absolute; top: 10px; right: 20px;
            font-size: 28px; font-weight: bold; cursor: pointer;
        }

        #puzzle-body button, #submit-password, #start-game-button {
            display: block; width: 80%; margin: 10px auto; padding: 15px;
            font-size: 16px; border-radius: 5px; border: 1px solid #ccc;
            background-color: #f0f0f0; cursor: pointer; transition: background-color 0.2s;
        }

        #puzzle-body button:hover, #submit-password:hover, #start-game-button:hover {
             background-color: #ddd;
        }

        #submit-password, #start-game-button {
            background-color: #4CAF50; color: white; margin-top: 20px;
        }
        
        #submit-password:hover, #start-game-button:hover {
            background-color: #45a049;
        }

        #password-input {
            width: 70%; padding: 15px; margin: 10px auto 20px;
            font-size: 18px; text-align: center; border: 1px solid #ccc; border-radius: 5px;
        }
        
        #memory-game {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;
            padding: 10px; justify-content: center;
        }

        .memory-card {
            width: 70px; height: 90px; perspective: 1000px; cursor: pointer;
        }

        .card-inner {
            position: relative; width: 100%; height: 100%;
            transition: transform 0.6s; transform-style: preserve-3d;
        }

        .memory-card.flipped .card-inner { transform: rotateY(180deg); }

        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; display: flex; justify-content: center;
            align-items: center; font-size: 2.5em; border-radius: 10px; border: 2px solid #555;
        }
        
        .s1-card-front { background-color: #FFD700; }
        .s1-card-back { background-color: #FFA07A; transform: rotateY(180deg); }
        .s2-card-front { background-color: dodgerblue; }
        .s2-card-back { background-color: lightcoral; transform: rotateY(180deg); }
    </style>
</head>
<body>
    <!-- ì‹œì‘ í™”ë©´ ëª¨ë‹¬ -->
    <div id="start-screen" class="modal" style="display: flex;">
        <div class="modal-content">
            <h2>ë°©íƒˆì¶œ ì±Œë¦°ì§€</h2>
            <p>ë„ì „ì„ ì‹œì‘í•˜ê¸° ì „ì— ì´ë¦„, í•™ë…„, ë°˜ì„ ì•Œë ¤ì£¼ì„¸ìš”.</p>
            <input type="text" id="player-name" placeholder="ì´ë¦„" required>
            <input type="number" id="player-grade" placeholder="í•™ë…„" required>
            <input type="number" id="player-class" placeholder="ë°˜" required>
            <button id="start-game-button">ê²Œì„ ì‹œì‘</button>
        </div>
    </div>

    <!-- 1ë‹¨ê³„: ì„±í­ë ¥ ì˜ˆë°© êµì‹¤ -->
    <div id="stage1-container" class="room-container">
        <img src="https://raw.githubusercontent.com/leesinwhi/experimental-mouse_1/refs/heads/main/Whisk_4857bb6ffa.jpg" alt="êµì‹¤ ë°°ê²½" class="background-image">
        <div class="object" id="s1-pencil-case"></div>
        <div class="object" id="s1-bookshelf"></div>
        <div class="object" id="s1-poster"></div>
        <div class="object" id="s1-school-bag"></div>
        <div class="object" id="s1-door"></div>
    </div>

    <!-- 2ë‹¨ê³„: ìˆ˜ì˜ ì•ˆì „ êµìœ¡ -->
    <div id="stage2-container" class="room-container">
        <img src="https://raw.githubusercontent.com/leesinwhi/experimental-mouse_1/refs/heads/main/IMAGE1.jpg" alt="ë§ˆë²•ì‚¬ ë°© ë°°ê²½" class="background-image">
        <div class="object" id="s2-beads"></div>
        <div class="object" id="s2-bookshelf"></div>
        <div class="object" id="s2-wizard"></div>
        <div class="object" id="s2-potion"></div>
        <div class="object" id="s2-fireplace"></div>
    </div>

    <!-- ê³µìš© í€´ì¦ˆ/ê²Œì„ ëª¨ë‹¬ -->
    <div id="puzzle-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-button">Ã—</span>
            <h2 id="puzzle-title"></h2>
            <div id="puzzle-body"></div>
        </div>
    </div>

    <!-- ê³µìš© ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ -->
    <div id="password-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-button">Ã—</span>
            <h2 id="password-title"></h2>
            <p>íƒˆì¶œí•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
            <input type="text" id="password-input" placeholder="ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬" maxlength="4" pattern="\d*">
            <button id="submit-password">íƒˆì¶œ</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- ê³µí†µ ë³€ìˆ˜ ë° ìš”ì†Œ ---
            let playerData = {};
            let currentStage = 1; 
            const hints = { stage1: {}, stage2: {} };

            const startScreen = document.getElementById('start-screen');
            const startGameButton = document.getElementById('start-game-button');
            const playerNameInput = document.getElementById('player-name');
            const playerGradeInput = document.getElementById('player-grade');
            const playerClassInput = document.getElementById('player-class');
            
            const stage1Container = document.getElementById('stage1-container');
            const stage2Container = document.getElementById('stage2-container');

            const puzzleModal = document.getElementById('puzzle-modal');
            const passwordModal = document.getElementById('password-modal');
            const closeButtons = document.querySelectorAll('.close-button');
            
            const puzzleTitle = document.getElementById('puzzle-title');
            const puzzleBody = document.getElementById('puzzle-body');
            const passwordTitle = document.getElementById('password-title');
            const passwordInput = document.getElementById('password-input');
            const submitPassword = document.getElementById('submit-password');

            // --- ëª¨ë‹¬ ê´€ë¦¬ í•¨ìˆ˜ ---
            const openModal = (modal) => { modal.style.display = 'flex'; };
            const closeModal = () => {
                puzzleModal.style.display = 'none';
                passwordModal.style.display = 'none';
                passwordInput.value = '';
            };
            
            const handleWrongAnswer = () => alert('í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ í•œë²ˆ ì˜ ìƒê°í•´ ë³´ì„¸ìš”.');

            // --- 1ë‹¨ê³„ ì˜¤ë¸Œì íŠ¸ ë° ì´ë²¤íŠ¸ ---
            const s1_objects = {
                pencilCase: document.getElementById('s1-pencil-case'),
                bookshelf: document.getElementById('s1-bookshelf'),
                poster: document.getElementById('s1-poster'),
                schoolBag: document.getElementById('s1-school-bag'),
                door: document.getElementById('s1-door')
            };

            s1_objects.pencilCase.addEventListener('click', () => {
                alert('íŒíŠ¸: 1ë‹¨ê³„ ë¹„ë°€ë²ˆí˜¸ ì²« ë²ˆì§¸ ìˆ«ìëŠ” [ 7 ] ì…ë‹ˆë‹¤.');
                hints.stage1['first'] = '7';
            });
            s1_objects.bookshelf.addEventListener('click', () => {
                puzzleTitle.textContent = '1ë‹¨ê³„ - ì˜ˆë°© í€´ì¦ˆ 1';
                puzzleBody.innerHTML = `
                    <p>ë‚˜ì˜ ëª¸ì— ëŒ€í•´ ë¶ˆí¸í•œ ëŠë‚Œì´ ë“¤ê²Œ í•˜ëŠ” í–‰ë™ì„<br>ë‹¤ë¥¸ ì‚¬ëŒì´ í•  ë•Œ, ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?</p>
                    <button>ì¹œí•œ ì‚¬ì´ì—ëŠ” ê´œì°®ë‹¤ê³  ìƒê°í•œë‹¤</button>
                    <button class="correct">ì‹«ë‹¤ê³  ë¶„ëª…íˆ ë§í•˜ê³ , ì–´ë¥¸ì—ê²Œ ì•Œë¦°ë‹¤</button>
                    <button>ë¬´ì„œìš°ë‹ˆ ì°¸ê³  ê°€ë§Œíˆ ìˆëŠ”ë‹¤</button>`;
                openModal(puzzleModal);
                puzzleBody.querySelector('.correct').onclick = () => {
                    if (!hints.stage1['second']) {
                        alert('ì •ë‹µì…ë‹ˆë‹¤! ë‘ ë²ˆì§¸ ë¹„ë°€ë²ˆí˜¸ëŠ” [ 1 ] ì…ë‹ˆë‹¤.');
                        hints.stage1['second'] = '1';
                    } else { alert('ì´ë¯¸ íŒíŠ¸ë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤.'); }
                    closeModal();
                };
                puzzleBody.querySelectorAll('button:not(.correct)').forEach(btn => { btn.onclick = handleWrongAnswer; });
            });
            s1_objects.poster.addEventListener('click', () => {
                puzzleTitle.textContent = '1ë‹¨ê³„ - ì˜ˆë°© í€´ì¦ˆ 2';
                puzzleBody.innerHTML = `
                    <p>ì–´ë µê³  í˜ë“  ì¼ì´ ìˆì„ ë•Œ, ë„ì›€ì„ ìš”ì²­í•  ìˆ˜ ìˆëŠ”<br>ê°€ì¥ ì˜¬ë°”ë¥¸ ê³³ì€ ì–´ë””ì¼ê¹Œìš”?</p>
                    <button class="correct">ë¶€ëª¨ë‹˜, ì„ ìƒë‹˜, 117 ì‹ ê³ ì„¼í„°</button>
                    <button>í˜¼ìì„œ í•´ê²°í•˜ë ¤ê³  ë…¸ë ¥í•œë‹¤</button>
                    <button>ì•„ë¬´ì—ê²Œë„ ë§í•˜ì§€ ì•ŠëŠ”ë‹¤</button>`;
                openModal(puzzleModal);
                puzzleBody.querySelector('.correct').onclick = () => {
                    if (!hints.stage1['third']) {
                        alert('ì •ë‹µì…ë‹ˆë‹¤! ì„¸ ë²ˆì§¸ ë¹„ë°€ë²ˆí˜¸ëŠ” [ 7 ] ì…ë‹ˆë‹¤.');
                        hints.stage1['third'] = '7';
                    } else { alert('ì´ë¯¸ íŒíŠ¸ë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤.'); }
                    closeModal();
                };
                puzzleBody.querySelectorAll('button:not(.correct)').forEach(btn => { btn.onclick = handleWrongAnswer; });
            });
            s1_objects.schoolBag.addEventListener('click', () => {
                if (hints.stage1['fourth']) { alert('ì´ë¯¸ ë¯¸ë‹ˆê²Œì„ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.'); return; }
                puzzleTitle.textContent = '1ë‹¨ê³„ - ë„ì›€ ìš”ì²­ ì¹´ë“œ ë§ì¶”ê¸°';
                puzzleBody.innerHTML = '<h4>ê°™ì€ ê·¸ë¦¼ì˜ ì¹´ë“œë¥¼ ì°¾ì•„ ë§ì¶”ì„¸ìš”!</h4><div id="memory-game"></div>';
                createMemoryGame(1);
                openModal(puzzleModal);
            });
            s1_objects.door.addEventListener('click', () => {
                passwordTitle.textContent = "êµì‹¤ ë¬¸";
                openModal(passwordModal);
            });

            // --- 2ë‹¨ê³„ ì˜¤ë¸Œì íŠ¸ ë° ì´ë²¤íŠ¸ ---
            const s2_objects = {
                beads: document.getElementById('s2-beads'),
                bookshelf: document.getElementById('s2-bookshelf'),
                wizard: document.getElementById('s2-wizard'),
                potion: document.getElementById('s2-potion'),
                fireplace: document.getElementById('s2-fireplace')
            };

            s2_objects.beads.addEventListener('click', () => {
                alert('íŒíŠ¸: 2ë‹¨ê³„ ë¹„ë°€ë²ˆí˜¸ ì²« ë²ˆì§¸ ìˆ«ìëŠ” 3ì…ë‹ˆë‹¤.');
                hints.stage2['first'] = '3';
            });
            s2_objects.bookshelf.addEventListener('click', () => {
                puzzleTitle.textContent = '2ë‹¨ê³„ - ìˆ˜ì˜ ì•ˆì „ í€´ì¦ˆ 1';
                puzzleBody.innerHTML = `
                    <p>ìˆ˜ì˜ì¥ì—ì„œ ë¬¼ì— ë“¤ì–´ê°€ê¸° ì „, ë°˜ë“œì‹œ í•´ì•¼ í•˜ëŠ” ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?</p>
                    <button>ë§›ìˆëŠ” ê°„ì‹ ë¨¹ê¸°</button>
                    <button class="correct">ì¶©ë¶„í•œ ì¤€ë¹„ìš´ë™ í•˜ê¸°</button>
                    <button>ì¹œêµ¬ì™€ ë°”ë¡œ ë¬¼ì¥êµ¬ì¹˜ê¸°</button>`;
                openModal(puzzleModal);
                puzzleBody.querySelector('.correct').onclick = () => {
                    if (!hints.stage2['second']) {
                        alert('ì •ë‹µì…ë‹ˆë‹¤! ë‘ ë²ˆì§¸ ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì…ë‹ˆë‹¤.');
                        hints.stage2['second'] = '4';
                    } else { alert('ì´ë¯¸ íŒíŠ¸ë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤.'); }
                    closeModal();
                };
                puzzleBody.querySelectorAll('button:not(.correct)').forEach(btn => { btn.onclick = () => alert('í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”.'); });
            });
            s2_objects.wizard.addEventListener('click', () => {
                puzzleTitle.textContent = '2ë‹¨ê³„ - ìˆ˜ì˜ ì•ˆì „ í€´ì¦ˆ 2';
                puzzleBody.innerHTML = `
                    <p>ë¬¼ì— ë¹ ì§„ ì‚¬ëŒì„ ë°œê²¬í–ˆì„ ë•Œ, ê°€ì¥ ë¨¼ì € í•´ì•¼ í•  ì˜¬ë°”ë¥¸ í–‰ë™ì€ ë¬´ì—‡ì¼ê¹Œìš”?</p>
                    <button class="correct">ì–´ë¥¸ì—ê²Œ ì•Œë¦¬ê³  119ì— ì‹ ê³ í•˜ê¸°</button>
                    <button>ì•„ë¬´ë„ ëª¨ë¥´ê²Œ ì¡°ìš©íˆ ìˆëŠ”ë‹¤</button>
                    <button>ë‚´ê°€ ì§ì ‘ êµ¬í•˜ê¸° ìœ„í•´ ë¬¼ì— ë›°ì–´ë“ ë‹¤</button>`;
                openModal(puzzleModal);
                puzzleBody.querySelector('.correct').onclick = () => {
                    if (!hints.stage2['third']) {
                        alert('ì •ë‹µì…ë‹ˆë‹¤! ì„¸ ë²ˆì§¸ ë¹„ë°€ë²ˆí˜¸ëŠ” 0ì…ë‹ˆë‹¤.');
                        hints.stage2['third'] = '0';
                    } else { alert('ì´ë¯¸ íŒíŠ¸ë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤.'); }
                    closeModal();
                };
                puzzleBody.querySelectorAll('button:not(.correct)').forEach(btn => { btn.onclick = () => alert('í‹€ë ¸ìŠµë‹ˆë‹¤. ìœ„í—˜í•œ í–‰ë™ì´ì—ìš”!'); });
            });
            s2_objects.potion.addEventListener('click', () => {
                if (hints.stage2['fourth']) { alert('ì´ë¯¸ ë¯¸ë‹ˆê²Œì„ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.'); return; }
                puzzleTitle.textContent = '2ë‹¨ê³„ - ì•ˆì „ ìˆ˜ì¹™ ì¹´ë“œ ë§ì¶”ê¸°';
                puzzleBody.innerHTML = '<h4>ê°™ì€ ì•ˆì „ ìˆ˜ì¹™ ì¹´ë“œë¥¼ ë§ì¶”ì„¸ìš”!</h4><div id="memory-game"></div>';
                createMemoryGame(2);
                openModal(puzzleModal);
            });
            s2_objects.fireplace.addEventListener('click', () => {
                passwordTitle.textContent = "ë§ˆë²• ì•„ê¶ì´";
                openModal(passwordModal);
            });

            // --- ê²Œì„ ì‹œì‘ ë° íë¦„ ì œì–´ ---
            startGameButton.addEventListener('click', () => {
                const name = playerNameInput.value.trim();
                const grade = playerGradeInput.value.trim();
                const classNum = playerClassInput.value.trim();

                if (name && grade && classNum) {
                    playerData = { name, grade, classNum };
                    startScreen.style.display = 'none';
                    stage1Container.style.display = 'block';
                } else {
                    alert('ì´ë¦„, í•™ë…„, ë°˜ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }
            });
            
            submitPassword.addEventListener('click', () => {
                if (currentStage === 1) {
                    if (passwordInput.value === '7179') {
                        alert(`ì¶•í•˜í•©ë‹ˆë‹¤, ${playerData.name} í•™ìƒ! 1ë‹¨ê³„ë¥¼ í´ë¦¬ì–´í–ˆìŠµë‹ˆë‹¤.\nì´ì œ ë‹¤ìŒ ì¥ì†Œë¡œ ì´ë™í•©ë‹ˆë‹¤!`);
                        closeModal();
                        // ìŠ¤í…Œì´ì§€ ì „í™˜
                        stage1Container.style.display = 'none';
                        stage2Container.style.display = 'block';
                        currentStage = 2;
                    } else {
                        alert('1ë‹¨ê³„ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. ì–»ì€ íŒíŠ¸ë“¤ì„ ë‹¤ì‹œ í™•ì¸í•´ë³´ì„¸ìš”.');
                    }
                } else if (currentStage === 2) {
                    if (passwordInput.value === '3405') {
                        alert(`ìµœì¢… íƒˆì¶œ ì„±ê³µ! ì¶•í•˜í•©ë‹ˆë‹¤, ${playerData.name} í•™ìƒ!\nëª¨ë“  ì•ˆì „ êµìœ¡ ì±Œë¦°ì§€ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!`);
                        closeModal();
                        // ê²Œì„ ì¢…ë£Œ ì²˜ë¦¬ (ì˜ˆ: ì²« í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°)
                        setTimeout(() => location.reload(), 2000);
                    } else {
                        alert('2ë‹¨ê³„ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ë°©ì˜ íŒíŠ¸ë“¤ì„ ì°¾ì•„ë³´ì„¸ìš”.');
                    }
                }
            });

            // --- ê³µìš© ê¸°ëŠ¥ ---
            closeButtons.forEach(button => { button.onclick = () => closeModal(); });
            window.onclick = (event) => {
                if (event.target == puzzleModal || event.target == passwordModal) {
                    closeModal();
                }
            };
            
            function createMemoryGame(stage) {
                const gameBoard = document.getElementById('memory-game');
                gameBoard.innerHTML = '';
                
                const s1_cards = ['ğŸ™…', 'ğŸ™…', 'ğŸ—£ï¸', 'ğŸ—£ï¸', 'ğŸ¤', 'ğŸ¤', 'â¤ï¸', 'â¤ï¸'];
                const s2_cards = ['ğŸŠ', 'ğŸŠ', 'ğŸ¦º', 'ğŸ¦º', 'ğŸ†˜', 'ğŸ†˜', 'ğŸš«', 'ğŸš«'];
                const cardsArray = (stage === 1) ? s1_cards : s2_cards;
                const cardFrontClass = (stage === 1) ? 's1-card-front' : 's2-card-front';
                const cardBackClass = (stage === 1) ? 's1-card-back' : 's2-card-back';
                const successAlert = (stage === 1)
                    ? 'ë¯¸ë‹ˆê²Œì„ ì„±ê³µ! 1ë‹¨ê³„ ë§ˆì§€ë§‰ ë¹„ë°€ë²ˆí˜¸ëŠ” [ 9 ] ì…ë‹ˆë‹¤.'
                    : 'ë¯¸ë‹ˆê²Œì„ ì„±ê³µ! 2ë‹¨ê³„ ë§ˆì§€ë§‰ ë¹„ë°€ë²ˆí˜¸ëŠ” 5ì…ë‹ˆë‹¤.';
                const hintKey = (stage === 1) ? '9' : '5';

                cardsArray.sort(() => 0.5 - Math.random());
                let flippedCards = [], matchedPairs = 0, lockBoard = false;

                cardsArray.forEach(cardValue => {
                    const card = document.createElement('div');
                    card.classList.add('memory-card');
                    card.dataset.value = cardValue;
                    card.innerHTML = `
                        <div class="card-inner">
                            <div class="card-face ${cardFrontClass}"></div>
                            <div class="card-face ${cardBackClass}">${cardValue}</div>
                        </div>`;
                    
                    card.addEventListener('click', () => {
                        if (lockBoard || card.classList.contains('flipped')) return;
                        card.classList.add('flipped');
                        flippedCards.push(card);

                        if (flippedCards.length === 2) {
                            lockBoard = true;
                            if (flippedCards[0].dataset.value === flippedCards[1].dataset.value) {
                                matchedPairs++;
                                flippedCards = [];
                                lockBoard = false;
                                if (matchedPairs === cardsArray.length / 2) {
                                    setTimeout(() => {
                                        alert(successAlert);
                                        hints[`stage${stage}`]['fourth'] = hintKey;
                                        closeModal();
                                    }, 500);
                                }
                            } else {
                                setTimeout(() => {
                                    flippedCards.forEach(c => c.classList.remove('flipped'));
                                    flippedCards = [];
                                    lockBoard = false;
                                }, 1000);
                            }
                        }
                    });
                    gameBoard.appendChild(card);
                });
            }
        });
    </script>
</body>
</html>