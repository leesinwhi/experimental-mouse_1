<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>방탈출: 안전한 교실 만들기 (최종 완성판)</title>
    <style>
        /* --- 기본 및 레이아웃 설정 --- */
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; font-family: 'Malgun Gothic', sans-serif; 
            background-color: #000;
        }
        #room-container { 
            position: relative; width: 100%; height: 100%; 
            transition: filter 0.5s;
        }
        #room-container img { 
            width: 100%; height: 100%; object-fit: contain; 
        }

        /* --- 우측 상단 UI (타이머, 정답 버튼) --- */
        #top-right-ui {
            position: fixed; top: 15px; right: 15px; z-index: 5;
            display: none; /* 게임 시작 후 flex로 변경 */
            flex-direction: row;
            align-items: center;
            gap: 15px; /* 타이머와 버튼 사이 간격 */
        }
        #game-timer {
            background-color: rgba(0, 0, 0, 0.6); color: white;
            font-size: 1.3em; font-weight: bold;
            padding: 10px 20px; border-radius: 10px;
            font-family: 'Courier New', monospace;
        }
        #answer-button {
            padding: 8px 15px; font-size: 0.9em; font-weight: bold;
            background-color: #6c757d; color: white;
            border-radius: 8px; border: none; cursor: pointer;
            transition: background-color 0.2s;
        }
        #answer-button:hover { background-color: #5a6268; }

        /* --- 시작 화면 스타일 --- */
        #start-screen {
            position: fixed; z-index: 20; top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex; justify-content: center; align-items: center;
        }

        /* --- 클릭 가능 오브젝트 스타일 --- */
        .clickable-object {
            position: absolute;
            cursor: pointer;
            transition: box-shadow 0.3s ease-in-out, background-color 0.3s ease-in-out;
            /* 점선 테두리 제거됨 */
        }
        .clickable-object:hover {
            background-color: rgba(255, 255, 0, 0.2);
            box-shadow: 0 0 15px 5px rgba(255, 255, 0, 0.7);
        }

        /* 오브젝트 위치 */
        #obj-chalkboard { top: 10%; left: 28%; width: 48%; height: 35%; }
        #obj-frame { top: 11%; left: 16%; width: 9%; height: 14%; }
        #obj-pencil { top: 60%; left: 28%; width: 11%; height: 9%; }
        #obj-chair { top: 57%; left: 45%; width: 15%; height: 32%; }
        #obj-door { top: 27%; left: 0; width: 13%; height: 60%; }

        /* --- 모달 팝업 및 공통 스타일 --- */
        .modal-popup { display: none; position: fixed; z-index: 10; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); justify-content: center; align-items: center; padding: 10px; box-sizing: border-box; }
        .modal-content { background-color: #fff; padding: 30px; border-radius: 15px; width: 90%; max-width: 450px; text-align: center; position: relative; box-shadow: 0 5px 20px rgba(0,0,0,0.25); }
        .close-button { position: absolute; top: 10px; right: 20px; font-size: 32px; font-weight: bold; cursor: pointer; color: #aaa; }
        .hint { display: none; margin-top: 15px; font-weight: bold; color: #007bff; font-size: 1.1em; }
        input[type="text"], input[type="number"] { width: 80%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 8px; text-align: center; font-size: 1em; }
        button { padding: 12px 25px; border: none; background-color: #007bff; color: white; border-radius: 8px; font-size: 1.1em; cursor: pointer; transition: background-color 0.2s; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        
        /* --- 메모리 게임 스타일 --- */
        #memory-board { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 20px auto; max-width: 320px; perspective: 1000px; }
        .card { width: 100%; aspect-ratio: 1 / 1; position: relative; cursor: pointer; user-select: none; transform-style: preserve-3d; transition: transform 0.6s; }
        .card.flipped { transform: rotateY(180deg); }
        .card.matched { cursor: not-allowed; opacity: 0.5; }
        .card-face { position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; font-size: 2.5em; border-radius: 10px; backface-visibility: hidden; }
        .card-front { background-color: #e8eaf6; color: #333; transform: rotateY(180deg); }
        .card-back { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-size: 1.5em; }
    </style>
</head>
<body>
    <!-- 우측 상단 UI -->
    <div id="top-right-ui">
        <button id="answer-button">정답</button>
        <div id="game-timer">00:00</div>
    </div>
    
    <!-- 시작 화면 -->
    <div id="start-screen"><div class="modal-content"><h2>방탈출: 안전한 교실 만들기</h2><p>프로젝트를 시작하기 전, 당신의 정보를 알려주세요.</p><input type="number" id="player-grade" placeholder="학년"><input type="number" id="player-class" placeholder="반"><input type="text" id="player-name" placeholder="이름"><button id="start-game-button">프로젝트 시작</button></div></div>

    <!-- 메인 게임 화면 -->
    <div id="room-container">
        <img src="https://i.ibb.co/PzwxG2CG/Whisk-storyboarde41407f036714026bfd3ce98.jpg" alt="교실 배경">
        <div id="obj-chalkboard" class="clickable-object" title="칠판"></div>
        <div id="obj-frame" class="clickable-object" title="액자"></div>
        <div id="obj-pencil" class="clickable-object" title="연필"></div>
        <div id="obj-chair" class="clickable-object" title="의자"></div>
        <div id="obj-door" class="clickable-object" title="교실문"></div>
    </div>

    <!-- 팝업 모달들 -->
    <div id="frame-modal" class="modal-popup"><div class="modal-content"><span class="close-button">×</span><h2>액자 속 다짐</h2><p>액자를 보니 중요한 약속이 떠오른다.<br>"우리 사이의 '경계'를 존중하겠다는 약속."<br><br><strong>비밀번호의 첫 번째 숫자는 '둘(2)' 사이의 약속임을 의미한다.</strong></p></div></div>
    <div id="chalkboard-modal" class="modal-popup"><div class="modal-content"><span class="close-button">×</span><h2>칠판의 규칙</h2><p>친구가 장난이라며 내 동의 없이 내 사진을 온라인에 올리려고 한다.<br>이런 행동은 몇 번까지 허용될 수 있을까?</p><input type="text" id="quiz1-answer" placeholder="숫자로 입력"><button id="submit-quiz1">확인</button><p id="quiz1-hint" class="hint"></p></div></div>
    <div id="chair-modal" class="modal-popup"><div class="modal-content"><span class="close-button">×</span><h2>가장 중요한 약속</h2><p>모든 관계에서 가장 기본이 되며, 상대방의 의사를 묻고 존중하는 것을 의미하는 두 글자 단어는 무엇일까?</p><input type="text" id="quiz2-answer" placeholder="한글 두 글자"><button id="submit-quiz2">확인</button><p id="quiz2-hint" class="hint"></p></div></div>
    <div id="pencil-modal" class="modal-popup"><div class="modal-content"><span class="close-button">×</span><h2>연필로 배우는 개념들</h2><p>안전한 관계를 위해 꼭 알아야 할 개념들입니다. 같은 아이콘의 카드를 맞춰주세요.</p><div id="memory-board"></div><p id="memory-hint" class="hint"></p></div></div>
    <div id="door-modal" class="modal-popup"><div class="modal-content"><span class="close-button">×</span><h2>안전한 교실 만들기</h2><p>배운 내용으로 4자리 비밀번호를 완성하세요.</p><input type="text" id="final-password" maxlength="4" placeholder="비밀번호 4자리"><button id="submit-final">프로젝트 완료</button></div></div>
    
    <!-- 엔딩 화면 -->
    <div id="outro-modal" class="modal-popup"><div class="modal-content"><h2 id="outro-title">프로젝트 성공!</h2><p id="outro-time" style="font-size: 1.1em; color: #333;"></p><p>우리가 함께 배운 안전한 교실을 만드는 4가지 약속입니다.</p><ul style="text-align: left; margin: 20px auto; width: fit-content; line-height: 1.6;"><li>🖼️ 서로의 경계 존중하기</li><li>칠판에 낙서하지 않기 (동의 없는 촬영/공유 금지)</li><li>🪑 앉아서 진솔하게 '동의' 구하기</li><li>✏️ 함께 배우고 연대하기</li></ul><p>이 약속들을 꼭 기억해 주세요!</p><button id="close-outro-button">닫기</button></div></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- 전역 변수 및 요소 초기화 ---
        let playerName = '';
        const clues = new Set();
        const attemptCounters = { quiz1: 0, quiz2: 0, final: 0 };
        let startTime = 0;
        let timerInterval;

        const startScreen = document.getElementById('start-screen');
        const roomContainer = document.getElementById('room-container');
        const topRightUI = document.getElementById('top-right-ui');
        const timerDisplay = document.getElementById('game-timer');
        const answerButton = document.getElementById('answer-button');

        const modals = {};
        for (const key of ['frame', 'chalkboard', 'chair', 'pencil', 'door', 'outro']) {
            modals[key] = document.getElementById(`${key}-modal`);
        }
        
        roomContainer.style.filter = 'blur(5px)';

        // --- 시작 화면 로직 ---
        document.getElementById('start-game-button').addEventListener('click', () => {
            const grade = document.getElementById('player-grade').value;
            const className = document.getElementById('player-class').value;
            const name = document.getElementById('player-name').value;
            if (!grade || !className || !name) {
                alert('학년, 반, 이름을 모두 입력해주세요!'); return;
            }
            playerName = name;
            startScreen.style.display = 'none';
            roomContainer.style.filter = 'none';
            
            topRightUI.style.display = 'flex'; // 타이머와 버튼이 담긴 컨테이너 표시
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
        });

        // 타이머 업데이트 함수
        function updateTimer() {
            const totalSeconds = Math.floor((Date.now() - startTime) / 1000);
            const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
            const seconds = String(totalSeconds % 60).padStart(2, '0');
            timerDisplay.textContent = `${minutes}:${seconds}`;
        }
        
        // '정답 보기' 버튼 이벤트 리스너
        answerButton.addEventListener('click', () => {
            const userInput = prompt('관리자 비밀번호를 입력하세요:');
            if (userInput === '0935') {
                alert('최종 비밀번호는 [2025] 입니다.');
            } else if (userInput !== null) { // 사용자가 '취소'를 누르지 않았을 경우
                alert('비밀번호가 틀렸습니다.');
            }
        });

        // 오브젝트 클릭 이벤트
        document.getElementById('obj-frame').addEventListener('click', () => { modals.frame.style.display = 'flex'; clues.add('2'); });
        document.getElementById('obj-chalkboard').addEventListener('click', () => modals.chalkboard.style.display = 'flex');
        document.getElementById('obj-chair').addEventListener('click', () => modals.chair.style.display = 'flex');
        document.getElementById('obj-pencil').addEventListener('click', () => {
            modals.pencil.style.display = 'flex';
            if (!clues.has('5')) createMemoryGame();
        });

        // 모달 닫기 이벤트
        document.querySelectorAll('.close-button').forEach(btn => btn.addEventListener('click', e => e.target.closest('.modal-popup').style.display = 'none'));
        document.getElementById('close-outro-button').addEventListener('click', () => modals.outro.style.display = 'none');

        // 문제 1 & 2 로직 (3회 오답 시 힌트 제공)
        function setupQuiz(quizId, answer, hintText, clue) {
            document.getElementById(`submit-${quizId}`).addEventListener('click', e => {
                const input = document.getElementById(`${quizId}-answer`).value.trim();
                const hintElem = document.getElementById(`${quizId}-hint`);
                if (input === answer) {
                    hintElem.textContent = hintText.success;
                    hintElem.style.display = 'block'; clues.add(clue); e.target.disabled = true;
                } else {
                    attemptCounters[quizId]++;
                    if (attemptCounters[quizId] >= 3) {
                        alert(hintText.failAlert);
                        hintElem.textContent = hintText.failHint;
                        hintElem.style.display = 'block'; clues.add(clue); e.target.disabled = true;
                    } else { alert(`틀렸습니다. (남은 기회: ${3 - attemptCounters[quizId]}번)`); }
                }
            });
        }
        setupQuiz('quiz1', '0', {
            success: "정답입니다. 동의 없는 공유는 단 한 번도 안 돼요. 비밀번호의 두 번째 숫자는 [0]입니다.",
            failAlert: "세 번 이상 틀렸습니다. 정답은 '0'입니다. 동의 없는 촬영/공유는 절대 허용되지 않아요!",
            failHint: "힌트: 비밀번호의 두 번째 숫자는 [0]입니다."
        }, '0');
        setupQuiz('quiz2', '동의', {
            success: "맞아요! '동의'는 존중의 시작입니다. 비밀번호의 세 번째 숫자는 단어의 글자 수인 [2]입니다.",
            failAlert: "세 번 이상 틀렸습니다. 정답은 '동의'입니다.",
            failHint: "힌트: '동의'는 존중의 시작! 비밀번호의 세 번째 숫자는 [2]입니다."
        }, '2-2');

        // 메모리 게임 로직
        function createMemoryGame() {
            const board = document.getElementById('memory-board'), hint = document.getElementById('memory-hint');
            board.innerHTML = ''; hint.style.display = 'none';
            const cardIcons = ['🤝', '🤝', '🚫', '🚫', '📸', '📸', '❤️', '❤️'];
            cardIcons.sort(() => 0.5 - Math.random());
            let flippedCards = [], matchedPairs = 0;
            cardIcons.forEach(icon => {
                const card = document.createElement('div'); card.classList.add('card'); card.dataset.icon = icon;
                const front = document.createElement('div'); front.classList.add('card-face', 'card-front'); front.textContent = icon;
                const back = document.createElement('div'); back.classList.add('card-face', 'card-back'); back.textContent = '?';
                card.appendChild(front); card.appendChild(back); board.appendChild(card);
                card.addEventListener('click', () => {
                    if (card.classList.contains('flipped') || card.classList.contains('matched') || flippedCards.length === 2) return;
                    card.classList.add('flipped'); flippedCards.push(card);
                    if (flippedCards.length === 2) {
                        if (flippedCards[0].dataset.icon === flippedCards[1].dataset.icon) {
                            flippedCards.forEach(c => c.classList.add('matched')); flippedCards = []; matchedPairs++;
                            if (matchedPairs === cardIcons.length / 2) {
                                hint.textContent = "성공! 모든 개념을 익혔습니다. 비밀번호의 마지막 숫자는 우리가 함께 연대하자는 의미의 [5]입니다.";
                                hint.style.display = 'block'; clues.add('5');
                            }
                        } else { setTimeout(() => { flippedCards.forEach(c => c.classList.remove('flipped')); flippedCards = []; }, 1200); }
                    }
                });
            });
        }
        
        // 최종 탈출 로직
        document.getElementById('obj-door').addEventListener('click', () => {
            if (clues.size < 4) { alert('아직 교실의 모든 약속을 확인하지 못했어요!'); } 
            else { modals.door.style.display = 'flex'; }
        });

        document.getElementById('submit-final').addEventListener('click', () => {
            if (document.getElementById('final-password').value === '2025') {
                clearInterval(timerInterval);
                const finalTime = timerDisplay.textContent;
                document.getElementById('outro-title').textContent = `프로젝트 성공, ${playerName}님!`;
                document.getElementById('outro-time').textContent = `탈출 성공까지 걸린 시간: ${finalTime}`;
                modals.door.style.display = 'none';
                modals.outro.style.display = 'flex';
            } else {
                attemptCounters.final++;
                 if (attemptCounters.final >= 3) {
                    alert("세 번 이상 틀렸습니다. 우리가 배운 힌트들을 순서대로 조합해 보세요: (액자) → (칠판) → (의자) → (연필)");
                } else {
                    alert(`비밀번호가 맞지 않습니다. (남은 기회: ${3 - attemptCounters.final}번)`);
                }
            }
        });
    });
    </script>
</body>
</html>